
# Отчёт по разработке и оценке RAG-системы на основе знаний о Великой Отечественной войне

## 1. Постановка задачи и цель работы

В условиях роста интереса к историческим фактам и необходимости точного, контекстуально обоснованного ответа на вопросы пользователей, актуальной становится задача создания систем автоматизированного поиска и генерации ответов на основе верифицированных источников. В рамках данной работы ставилась задача разработки и комплексной оценки Retrieval-Augmented Generation (RAG)-системы, способной отвечать на вопросы по теме *Великой Отечественной войны 1941–1945 гг.* с использованием корпуса статей русскоязычной Википедии в качестве базы знаний.

**Цель работы** — проектирование, реализация и количественная оценка end-to-end производительности RAG-системы, включающей:
- модуль поиска релевантных фрагментов текста (retrieval),ы
- модуль генерации ответа на основе найденного контекста (generation),
- систему объективной метрической оценки корректности как поиска, так и генерации.


---

## 2. Теоретическая база

### 2.1. Архитектура Retrieval-Augmented Generation (RAG)

RAG-система объединяет два компонента [1]:

1. **Retriever** — модуль поиска, основанный на семантическом сходстве между запросом пользователя и документами в базе знаний. В данной реализации использовано косинусное расстояние между векторными представлениями (эмбеддингами), полученными с помощью модели `text-embedding-ada-002` (OpenAI). Для запроса $ q $ и документа $ d_i $ вычисляется схожесть:

sim(q, d_i) = 1 − cos(e_q, e_d_i), где e_q, e_d_i ∈ ℝ¹⁵³⁶ — эмбеддинги.

2. **Generator** — языковая модель (`gpt-3.5-turbo`), получающая на вход инструкцию, релевантные фрагменты текста и пользовательский запрос. Генерация осуществляется в детерминистическом режиме (`temperature = 0`), что обеспечивает воспроизводимость результатов.

### 2.2. Метрики оценки

Для объективной оценки предложена двухуровневая система метрик:

#### 2.2.1. Оценка retrieval (поиск)
- **Hit@k** — бинарный индикатор: 1, если среди топ-*k* извлечённых фрагментов присутствует хотя бы один, содержащий сущность из эталонного контекста (имя, дата, название в кавычках).
- **Reciprocal Rank (RR)** — учёт позиции первого релевантного фрагмента:
   
RR = 1 / rank_first,

#### 2.2.2. Оценка generation (генерация)
- **Семантическое сходство** — косинусное сходство эмбеддингов ответа модели и эталонного ответа (`text-embedding-ada-002`).
- **Перекрытие фактов (fact overlap)** — доля совпадающих категорий фактов между ответом и эталоном:

fact_sim = |A ∩ совпавших| / |A ∩ непустых|, где A = {даты, числа, имена, кавычные названия}.

  Факты извлекаются с помощью регулярных выражений:
  - даты: `22 июня 1941`, `1945`;
  - целые числа ≥ 100: `872`;
  - имена собственные: `[А-ЯЁ][а-яё]+(?:\s+[А-ЯЁ][а-яё]+){0,2}`;
  - названия в кавычках: `«Багратион»`.

- **Корректность генерации** — ответ считается верным, если он:
  - не содержит фразы *«Я не помню»*,
  - и либо семантически близок (`emb_similarity > 0.75`), либо полностью воспроизводит все ключевые факты (`fact_similarity = 1.0`).

#### 2.2.3. End-to-end оценка
- **End-to-End Accuracy** — доля вопросов, для которых одновременно корректны retrieval и generation.

---

## 3. Результаты работы и тестирования

### 3.1. Сбор и подготовка корпуса знаний

Исходно применялся автоматический сбор статей из категории *«Великая Отечественная война»* Википедии, что привело к получению 124 статьи.

Каждая статья разбивалась на секции по заголовкам второго уровня. После фильтрации коротких и служебных фрагментов получено 412 текстовых секций. Далее секции разбивались на чанки ≤ 1000 токенов. Итоговый корпус: 587 фрагментов.

### 3.2. Тестовый набор

Разработан тестовый набор из 10 вопросов различной сложности («easy», «medium», «hard»), охватывающий:
- хронологию (даты начала/окончания событий),
- ключевые личности (командиры, политики),
- стратегические операции,
- количественные характеристики (потери, длительность),
- культурные артефакты.

Примеры вопросов:
| Вопрос | Тип | Этalon |
|--------|------|--------|
| *Когда началась Великая Отечественная война?* | easy | `22 июня 1941 года` |
| *Какая битва считается крупнейшей танковой битвой в истории?* | medium | `Курская битва (Прохоровское сражение)` |
| *Какие были общие людские потери СССР в ВОВ?* | medium | `Около 27 миллионов человек` |

### 3.3. Результаты оценки

| Метрика | Значение |
|---------|----------|
| Retrieval Hit@5 | **100%** (10/10) |
| End-to-End Accuracy | **100%** (10/10) |

**Пример корректного ответа:**
> **Вопрос:** *Кто был Верховным Главнокомандующим в годы ВОВ?*  
> **Контекст (из статьи «Парад Победы»):** * Верховным Главнокомандующим в годы Великой Отечественной войны был Иосиф Виссари...*  
> **Ответ модели:** *Иосиф Сталин*  
> **Оценка:**  E2E: Да | Hit@5: Да

#### 3.3.3. Визуализация результатов

##### Таблица 1. Детализированные результаты по вопросам

| № | Вопрос | Hit@5 | Факты в контексте? | Ответ модели | E2E |
|---|--------|-------|---------------------|--------------|-----|
| 1 | Начало ВОВ | ✅ | ✅ | `22 июня 1941 года` | ✅ |
| 2 | Снятие блокады Ленинграда | ✅ | ✅ | `Блокада Ленинграда была полностью снята 27 января 1944 года.` | ✅ |
| 3 | Верховный Главнокомандующий | ✅ | ✅ | `Верховным Главнокомандующим в годы Великой Отечественной войны был Иосиф Виссари...` | ✅ |
| 4 | Операция «Багратион» | ✅ | ✅ | `Операция «Багратион» — это советская военная операция, начавшаяся 23 июня 1944 г...` | ✅ |
| 5 | «Дорога жизни» | ✅ | ✅ | `«Дорога жизни» — единственная транспортная магистраль, по которой во время блока...` | ✅ |
| 6 | Крупнейшая танковая битва | ✅ | ✅ | `Курская битва` | ✅ |
| 7 | Длительность блокады | ✅ | ✅ | `Блокада Ленинграда длилась 872 дня.` | ✅ |
| 8 | Потери СССР | ✅ | ✅ | `Общие людские потери СССР в Великой Отечественной войне оцениваются в 26,6 млн ч...` | ✅ |
| 9 | Причина провала «Цитадель» | ✅ | ✅ | `Победы Красной Армии под Курском и войск антигитлеровской коалиции в Сицилии сде...`| ✅ |
| 10 | Обращение Молотова | ✅ | ✅ | `Обращение Молотова, которое он произнёс по радио 22 июня 1941 года в 12:15 минут...` | ✅ |

---

## 4. Выводы

1. Разработанная RAG-система демонстрирует высокую эффективность при наличии релевантного и сбалансированного корпуса знаний. End-to-End точность достигает 100% на наборе из 10 исторических вопросов.

2. Основным фактором, ограничивающим производительность, является полнота и структура базы знаний. Автоматический сбор по категориям без контроля содержимого приводит к доминированию узких тем и падению точности.

3. Предложенная система метрик, сочетающая семантическое сходство и фактологическое перекрытие, позволяет объективно оценивать качество ответов, особенно в задачах, где критична точность чисел и имён.

4. Для дальнейшего повышения точности необходимо:
   - расширить корпус за счёт культурных и мемориальных статей (поэзия, искусство, памятники),
   - усилить систему подсказок (prompt engineering) для предотвращения округления чисел,
   - рассмотреть fine-tuning модели на исторических текстах для улучшения интерпретации причинно-следственных связей (вопросы типа *«почему?»*).

Разработанная система может быть использована как основа для образовательных чат-ботов, цифровых музеев и интерактивных исторических справочников.

---

## 5. Использованные источники

1. Lewis, P., et al. (2020). *Retrieval-Augmented Generation for Knowledge-Intensive NLP Tasks*. Advances in Neural Information Processing Systems, 33, 9459–9474.  
2. OpenAI API Documentation. *Embeddings* и *Chat Completions*. https://platform.openai.com/docs  
3. Википедия. *Категория:Великая Отечественная война*. https://ru.wikipedia.org/wiki/Категория:Великая_Отечественная_война  
4. mwparserfromhell: MediaWiki Markup Parser. https://github.com/earwig/mwparserfromhell  
5. Pedregosa, F., et al. (2011). *Scikit-learn: Machine Learning in Python*. JMLR 12, pp. 2825–2830.  
6. Tiktoken: Fast BPE tokeniser for use with OpenAI’s models. https://github.com/openai/tiktoken  

---

### Приложение А. Список ключевых статей в финальном корпусе (30 шт.)

- Великая Отечественная война  
- Московская битва  
- Сталинградская битва  
- Курская битва  
- Операция «Багратион»  
- Блокада Ленинграда  
- Операция «Уран»  
- Операция «Кутузов»  
- Операция «Румянцев»  
- Ясско-Кишинёвская операция  
- Начало Великой Отечественной войны  
- Парад Победы  
- День Победы  
- Сталин, Иосиф Виссарионович  
- Жуков, Георгий Константинович  
- Рокоссовский, Константин Константинович  
- Чуйков, Василий Иванович  
- Василевский, Александр Михайлович  
- Молотов, Вячеслав Михайлович  
- Дорога жизни  
- Трудовой фронт в СССР во время Великой Отечественной войны  
- Эвакуация в СССР в годы Великой Отечественной войны  
- Обращение Молотова по радио 22 июня 1941 года  
- Речь Сталина 3 июля 1941 года  
- Песни Великой Отечественной войны  
- Берггольц, Ольга Фёдоровна  
- Ленинградская филармония в годы блокады  
- Международная конференция в Ялте  
- Потсдамская конференция  
- Потери СССР в Великой Отечественной войне  
- Агарковское движение
- Аксайская переправа
- Алтайский «Артек»
- Арктические конвои
- Арктические конвои (СССР)
- Бой под Зализницей
- Братский союз военнопленных
- Будь героем!
- Бытовые отряды
- Великая Отечественная война
- Великая Отечественная война (название)
- Военно-шефские комиссии
- Военнопленные в СССР во время Второй мировой войны
- Военный налог (1941—1945)
- Волжская рокада
- Встреча на Эльбе
- Всё для фронта! Всё для победы!
- Выставка образцов трофейного вооружения (Москва)
- Выступление Молотова по радио 22 июня 1941 года
- Выступление Сталина по радио 3 июля 1941 года
- Город первого салюта
- Городской комитет обороны
- Движение двухсотников
- Движение тысячников
- Депортация венгров и немцев Закарпатья
- Десять сталинских ударов
- Железнодорожная линия Астрахань — Кизляр
- Железнодорожная линия Сталинград — Владимировка
- Знак ранения
- Знамя Победы
- Ислам в годы Великой Отечественной войны
- Использование принудительного труда немецкого гражданского населения в СССР
- Итальянские войска в СССР (1941—1943)
- Керченский железнодорожный мост
- Колонны паровозов особого резерва
- Конно-механизированная группа
- Крампен
- Курская дуга
- Лагерь для интернированных лиц № III
- Легенда о «чистом вермахте»
- Людиновская подпольная комсомольская группа
- Марш пленных немцев по Москве
- Материнство и детство в блокадном Ленинграде
- Международный день освобождения узников нацистских концлагерей
- Международный день памяти жертв фашизма
- Молодая гвардия (подпольная организация)
- Наркомовские 100 грамм
- Народное ополчение блокадного Ленинграда
- Наше дело правое
- Непрочитанные письма 1941-го
- Ново-Петергофское военно-политическое училище пограничных и внутренних войск НКВД
- Оккупация территории СССР войсками нацистской Германии и её союзников
- Операция «Бандура»
- Операция «Барбаросса»
- Операция «Березино»
- Операция «Монастырь»
- Парад на Красной площади 7 ноября 1941 года
- Партизанский отряд «За Отчизну»
- Партийная мобилизация
- Перемещённые культурные ценности
- Периодические издания на оккупированной территории СССР в годы Великой Отечественной войны
- Печорский десант
- Покушение на Франца фон Папена
- Полевой военкомат
- Политбойцы
- Постановление ГКО № ГКО-3399
- Постановление ГКО № ГКО-5311
- Потери в Великой Отечественной войне
- Празднование Нового года в период Великой Отечественной войны
- Предыстория Великой Отечественной войны
- Принудительный труд венгров в СССР
- Проверочно-фильтрационные лагеря НКВД СССР
- Пропаганда во время Второй мировой войны
- Противовоздушная оборона Москвы в Великую Отечественную войну
- Реакция Сталина на начало Великой Отечественной войны
- Рейхскомиссариат Дон-Волга
- Соболевская акция
- Совет по эвакуации при СНК СССР
- Советские евреи в борьбе с нацизмом
- Советско-германский обмен интернированными
- Ставка Верховного главнокомандования
- Сталин во Второй мировой войне
- Студия военных художников имени М. Б. Грекова
- Сын полка
- Театр народного ополчения
- Тезис о превентивной войне Германии против СССР
- Трудовая мобилизация в Среднеазиатском военном округе
- Труженики тыла
- Фильтрационный лагерь НКВД № 188
- Фонд обороны
- Центральный архив Министерства обороны Российской Федерации
- Черкасовское движение
- Шлиссельбурская трасса
- Эвакуация и сохранение культурных ценностей в СССР
